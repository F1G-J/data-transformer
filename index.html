<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Data Transformer</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    textarea { width: 100%; height: 300px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    h2 { margin-top: 40px; }
  </style>
</head>
<body>
  <h1>Legacy Data Transformer</h1>
  <textarea id="inputData" placeholder="Paste legacy data here..."></textarea>
  <button onclick="processData()">Process</button>

  <div id="mainInfo"></div>
  <div id="wceTable"></div>

  <script>
    function processData() {
      const input = document.getElementById("inputData").value;
      const lines = input.split(/\r?\n/);

      let mainDataLine = "";
      let discrepancyLine = "";
      let extraDiscrepancy = "";
      let wceLines = [];
      let inWCEBlock = false;

      for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        if (line.includes("EVENT-ID") && i + 1 < lines.length) {
          mainDataLine = lines[i + 1];
        }
        if (line.startsWith("DISCREPANCY:")) {
          discrepancyLine = line.replace("DISCREPANCY:", "").trim();
          if (lines[i + 1] && lines[i + 1].trim()) {
            extraDiscrepancy = lines[i + 1].trim();
          }
        }
        if (line.includes("WCE-SEQ")) {
          inWCEBlock = true;
        } else if (line.startsWith("--")) {
          inWCEBlock = false;
        } else if (inWCEBlock && line.trim().startsWith("0")) {
          const narr = lines[i + 1] && lines[i + 1].startsWith("NARR:") ?
            lines[i + 1].replace("NARR:", "").trim() : "";
          wceLines.push({
            raw: line,
            description: narr
          });
        }
      }

      const eventID = mainDataLine.substring(0, 11).trim();
      const equipID = mainDataLine.substring(13, 20).trim();
      const wuc = mainDataLine.substring(22, 28).trim();
      const sym = mainDataLine.substring(49, 50).trim();
      const pri = mainDataLine.substring(54, 56).trim();
      const schedDate = mainDataLine.substring(72).trim();

      document.getElementById("mainInfo").innerHTML = `
        <h2>Main Information</h2>
        <p><strong>Event ID:</strong> ${eventID}</p>
        <p><strong>Equipment ID:</strong> ${equipID}</p>
        <p><strong>WUC:</strong> ${wuc}</p>
        <p><strong>Symbol:</strong> ${sym}</p>
        <p><strong>Priority:</strong> ${pri}</p>
        <p><strong>Scheduled:</strong> ${schedDate}</p>
        <p><strong>Discrepancy:</strong> ${discrepancyLine} ${extraDiscrepancy}</p>
      `;

      let tableHTML = `
        <h2>Work Center Events</h2>
        <table>
          <tr>
            <th>WCE-SEQ</th>
            <th>PWC</th>
            <th>Equip-ID</th>
            <th>WUC</th>
            <th>Symbol</th>
            <th>Scheduled</th>
            <th>Description</th>
          </tr>
      `;

      for (const wce of wceLines) {
        const line = wce.raw;
        const seq = line.substring(2, 7).trim();
        const pwc = line.substring(8, 13).trim();
        const eID = line.substring(14, 21).trim();
        const wuc = line.substring(24, 31).trim();
        const symbol = line.substring(42, 43).trim();
        const sched = line.substring(69).trim();

        tableHTML += `
          <tr>
            <td>${seq}</td>
            <td>${pwc}</td>
            <td>${eID}</td>
            <td>${wuc}</td>
            <td>${symbol}</td>
            <td>${sched}</td>
            <td>${wce.description}</td>
          </tr>
        `;
      }

      tableHTML += `</table>`;
      document.getElementById("wceTable").innerHTML = tableHTML;
    }
  </script>
</body>
</html>
