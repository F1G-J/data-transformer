<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Data Transformer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    textarea {
      width: 100%;
      height: 200px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
    .section-title {
      margin-top: 40px;
      font-size: 1.2em;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Data Transformer</h1>
  <p>Paste your data below:</p>
  <textarea id="inputData"></textarea><br>
  <button onclick="processData()">Process Data</button>

  <div id="output"></div>

  <script>
    function processData() {
      const input = document.getElementById("inputData").value;
      const lines = input.split("\n");
      const output = document.getElementById("output");
      output.innerHTML = "";

      let header = {
        eventId: "",
        equipId: "",
        wuc: "",
        sym: "",
        pri: "",
        schedDate: "",
        discrepancy: ""
      };

      let inWceSection = false;
      let wceData = [];
      let currentNarr = "";

      for (let i = 0; i < lines.length; i++) {
        const line = lines[i];

        // Main header row
        if (line.includes("EVENT-ID") && i + 1 < lines.length) {
          const nextLine = lines[i + 1];
          header.eventId = nextLine.substring(0, 10).trim();
          header.equipId = nextLine.substring(13, 20).trim();
          header.wuc = nextLine.substring(22, 30).trim();
          header.sym = nextLine.substring(49, 50).trim();
          header.pri = nextLine.substring(54, 56).trim();
          header.schedDate = nextLine.substring(68, 75).trim();
        }

        // Discrepancy lines
        if (line.trim().startsWith("DISCREPANCY:")) {
          header.discrepancy = line.replace("DISCREPANCY:", "").trim();
          if (lines[i + 1] && lines[i + 1].trim()) {
            header.discrepancy += " " + lines[i + 1].trim();
          }
        }

        // Start of WCE section
        if (line.includes("ON-EQUIPMENT WORK CENTER EVENTS")) {
          inWceSection = true;
        }

        // Process WCE lines
        if (inWceSection && line.match(/^\s*\d{3}/)) {
          const wce = {
            seq: line.substring(2, 6).trim(),
            pwc: line.substring(8, 14).trim(),
            equipId: line.substring(16, 23).trim(),
            wuc: line.substring(26, 33).trim(),
            sym: line.substring(45, 46).trim(),
            schedDate: line.substring(70, 77).trim(),
            narr: ""
          };
          currentNarr = "";
          if (lines[i + 1] && lines[i + 1].includes("NARR:")) {
            currentNarr = lines[i + 1].replace("NARR:", "").trim();
            wce.narr = currentNarr;
          }
          wceData.push(wce);
        }
      }

      // Display results
      let html = "<div class='section-title'>Main Information</div><table><tr><th>Event ID</th><th>Equip ID</th><th>WUC</th><th>Symbol</th><th>Priority</th><th>Sched Date</th><th>Discrepancy</th></tr>";
      html += `<tr><td>${header.eventId}</td><td>${header.equipId}</td><td>${header.wuc}</td><td>${header.sym}</td><td>${header.pri}</td><td>${header.schedDate}</td><td>${header.discrepancy}</td></tr>`;
      html += "</table>";

      if (wceData.length > 0) {
        html += "<div class='section-title'>Work Center Events</div><table><tr><th>Seq</th><th>PWC</th><th>Equip ID</th><th>WUC</th><th>Symbol</th><th>Sched Date</th><th>Description</th></tr>";
        for (const wce of wceData) {
          html += `<tr><td>${wce.seq}</td><td>${wce.pwc}</td><td>${wce.equipId}</td><td>${wce.wuc}</td><td>${wce.sym}</td><td>${wce.schedDate}</td><td>${wce.narr}</td></tr>`;
        }
        html += "</table>";
      }

      output.innerHTML = html;
    }
  </script>
</body>
</html>
