<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Maintenance Data Parser</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2em;
    }
    textarea {
      width: 100%;
      height: 300px;
      margin-bottom: 1em;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1em;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 0.5em;
      text-align: left;
    }
    th {
      background-color: #f4f4f4;
    }
  </style>
</head>
<body>
  <h1>Maintenance Data Parser</h1>
  <textarea id="rawData" placeholder="Paste legacy export text here..."></textarea>
  <button onclick="processData()">Parse Data</button>

  <h2>Main Information</h2>
  <div id="mainInfo"></div>

  <h2>Work Center Events</h2>
  <table id="wceTable">
    <thead>
      <tr>
        <th>WCE-SEQ</th>
        <th>PWC</th>
        <th>Equip-ID</th>
        <th>WUC</th>
        <th>Symbol</th>
        <th>Scheduled</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    function processData() {
      const raw = document.getElementById('rawData').value;
      const lines = raw.split("\n");

      let main = {
        eventId: '',
        equipId: '',
        wuc: '',
        symbol: '',
        priority: '',
        scheduled: '',
        discrepancy: ''
      };

      let wceList = [];
      let readingDiscrepancy = false;
      let readingWCE = false;
      let currentWCE = null;

      for (let line of lines) {
        const trimmed = line.trim();

        if (line.includes("EVENT-ID") && lines.indexOf(line) + 1 < lines.length) {
          const dataLine = lines[lines.indexOf(line) + 1];
          main.eventId = dataLine.substring(0, 11).trim();
          main.equipId = dataLine.substring(12, 20).trim();
          main.wuc = dataLine.substring(21, 36).trim();
          main.symbol = dataLine.substring(47, 49).trim();
          main.priority = dataLine.substring(52, 54).trim();
          main.scheduled = dataLine.substring(66).trim();
        } else if (trimmed.startsWith("DISCREPANCY:")) {
          main.discrepancy = trimmed.replace("DISCREPANCY:", "").trim();
          readingDiscrepancy = true;
        } else if (readingDiscrepancy && trimmed !== "" && !trimmed.startsWith("---")) {
          main.discrepancy += ' ' + trimmed;
        } else if (trimmed.includes("WCE-SEQ")) {
          readingWCE = true;
        } else if (readingWCE && /^\s*\d{3}/.test(line)) {
          currentWCE = {
            seq: line.substring(0, 5).trim(),
            pwc: line.substring(6, 13).trim(),
            equipId: line.substring(14, 23).trim(),
            wuc: line.substring(24, 39).trim(),
            symbol: line.substring(48, 49).trim(),
            scheduled: line.substring(70).trim(),
            description: ''
          };
          wceList.push(currentWCE);
        } else if (readingWCE && trimmed.startsWith("NARR:")) {
          if (currentWCE) currentWCE.description = trimmed.replace("NARR:", "").trim();
        }
      }

      // Display Main Info
      const mainDiv = document.getElementById('mainInfo');
      mainDiv.innerHTML = `
        <p><strong>Event ID:</strong> ${main.eventId}</p>
        <p><strong>Equipment ID:</strong> ${main.equipId}</p>
        <p><strong>WUC:</strong> ${main.wuc}</p>
        <p><strong>Symbol:</strong> ${main.symbol}</p>
        <p><strong>Priority:</strong> ${main.priority}</p>
        <p><strong>Scheduled:</strong> ${main.scheduled}</p>
        <p><strong>Discrepancy:</strong> ${main.discrepancy}</p>
      `;

      // Display WCE Table
      const tbody = document.querySelector('#wceTable tbody');
      tbody.innerHTML = '';
      wceList.forEach(wce => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${wce.seq}</td>
          <td>${wce.pwc}</td>
          <td>${wce.equipId}</td>
          <td>${wce.wuc}</td>
          <td>${wce.symbol}</td>
          <td>${wce.scheduled}</td>
          <td>${wce.description}</td>
        `;
        tbody.appendChild(row);
      });
    }
  </script>
</body>
</html>
