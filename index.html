<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Transformer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    h2 {
      margin-top: 40px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
  </style>
</head>

<body>
  <h2>Main Information</h2>
  <table id="mainInfoTable">
    <tbody></tbody>
  </table>

  <h2>Work Center Events</h2>
  <table id="wceTable">
    <thead>
      <tr>
        <th>WCE-SEQ</th>
        <th>PWC</th>
        <th>Equip-ID</th>
        <th>WUC</th>
        <th>Symbol</th>
        <th>Scheduled</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <textarea id="inputData" rows="20" cols="150" placeholder="Paste your data here"></textarea><br>
  <button onclick="processData()">Process</button>

  <script>
    function processData() {
      const lines = document.getElementById('inputData').value.split('\n');
      let mainInfo = {
        eventId: '',
        equipId: '',
        wuc: '',
        symbol: '',
        priority: '',
        scheduled: '',
        discrepancy: ''
      };

      let wceList = [];
      let currentWce = null;
      let inWceSection = false;
      let collectingDiscrepancy = false;

      for (let i = 0; i < lines.length; i++) {
        const line = lines[i];

        if (line.includes('EVENT-ID')) {
          const dataLine = lines[i + 1] || '';
          mainInfo.eventId = dataLine.substring(0, 11).trim();
          mainInfo.equipId = dataLine.substring(14, 21).trim();  // shifted left 2 chars
          mainInfo.wuc = dataLine.substring(23, 31).trim();      // shifted left 3 chars
          mainInfo.symbol = dataLine.substring(44, 45).trim();
          mainInfo.priority = dataLine.substring(48, 50).trim(); // shifted left 1 char
          mainInfo.scheduled = dataLine.substring(66).trim();
        }

        if (line.startsWith('DISCREPANCY:')) {
          mainInfo.discrepancy = line.replace('DISCREPANCY:', '').trim();
          collectingDiscrepancy = true;
        } else if (collectingDiscrepancy && line.trim() !== '') {
          mainInfo.discrepancy += ' ' + line.trim();
          collectingDiscrepancy = false;
        }

        if (line.includes('ON-EQUIPMENT WORK CENTER EVENTS')) {
          inWceSection = true;
        }

        if (inWceSection && line.match(/^\s*\d{3}/)) {
          currentWce = {
            seq: line.substring(0, 6).trim(),
            pwc: line.substring(7, 13).trim(),
            equipId: line.substring(14, 22).trim(),
            wuc: line.substring(23, 31).trim(),
            symbol: line.substring(41, 42).trim(),
            scheduled: line.substring(66).trim(),
            description: ''
          };
          wceList.push(currentWce);
        }

        if (line.startsWith('NARR:') && currentWce) {
          currentWce.description = line.replace('NARR:', '').trim();
        }
      }

      const mainTable = document.getElementById('mainInfoTable').querySelector('tbody');
      mainTable.innerHTML = `
        <tr><th>Event ID</th><td>${mainInfo.eventId}</td></tr>
        <tr><th>Equipment ID</th><td>${mainInfo.equipId}</td></tr>
        <tr><th>WUC</th><td>${mainInfo.wuc}</td></tr>
        <tr><th>Symbol</th><td>${mainInfo.symbol}</td></tr>
        <tr><th>Priority</th><td>${mainInfo.priority}</td></tr>
        <tr><th>Scheduled</th><td>${mainInfo.scheduled}</td></tr>
        <tr><th>Discrepancy</th><td>${mainInfo.discrepancy}</td></tr>
      `;

      const wceTable = document.getElementById('wceTable').querySelector('tbody');
      wceTable.innerHTML = '';
      wceList.forEach(wce => {
        wceTable.innerHTML += `
          <tr>
            <td>${wce.seq}</td>
            <td>${wce.pwc}</td>
            <td>${wce.equipId}</td>
            <td>${wce.wuc}</td>
            <td>${wce.symbol}</td>
            <td>${wce.scheduled}</td>
            <td>${wce.description}</td>
          </tr>
        `;
      });
    }
  </script>
</body>

</html>
