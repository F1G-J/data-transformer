<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Data Transformer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 1em;
      background-color: #f5f5f5;
    }
    textarea {
      width: 100%;
      height: 300px;
      margin-bottom: 1em;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 2em;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: left;
    }
    th {
      background-color: #eee;
    }
    h2 {
      margin-top: 2em;
    }
    .section {
      background-color: #fff;
      padding: 1em;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <h1>Data Transformer</h1>
  <div class="section">
    <textarea id="input" placeholder="Paste your data here..."></textarea>
    <button onclick="processData()">Transform</button>
  </div>

  <div class="section">
    <h2>Main Information</h2>
    <table id="mainInfoTable">
      <thead>
        <tr>
          <th>Event ID</th>
          <th>Equip ID</th>
          <th>WUC</th>
          <th>Symbol</th>
          <th>Priority</th>
          <th>Scheduled</th>
          <th>Discrepancy</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <h2>Work Center Events</h2>
    <table id="wceTable">
      <thead>
        <tr>
          <th>WCE Seq</th>
          <th>PWC</th>
          <th>Equip ID</th>
          <th>WUC</th>
          <th>Symbol</th>
          <th>Narrative</th>
          <th>Scheduled</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    function processData() {
      const input = document.getElementById("input").value;
      const lines = input.split("\n").map(line => line.trimEnd());
      let mainInfo = {};
      let discrepancyLines = [];

      const mainPattern = /^(.{9})\s{3}(.{5})\s{2}(.{5}).{11}.{10}.{3}(.{2}).{16}(.{7})$/;
      const wcePattern = /^\s*(\d{3})\s+(.{5})\s+(.{5})\s+(.{5}).{12}(@).{6}(.{5}).{3}SCHED\s+(\d{7})$/;

      for (let i = 0; i < lines.length; i++) {
        const line = lines[i];

        if (line.startsWith("$$EVID")) {
          const match = line.match(mainPattern);
          if (match) {
            mainInfo = {
              eventId: match[1].trim(),
              equipId: match[2].trim(),
              wuc: match[3].trim(),
              symbol: match[4].trim(),
              priority: line.slice(55, 57).trim(),
              scheduled: match[5].trim()
            };
          }
        }

        if (line.startsWith("DISCREPANCY:")) {
          discrepancyLines.push(line.replace("DISCREPANCY:", "").trim());
          if (lines[i + 1] && !lines[i + 1].includes("---")) {
            discrepancyLines.push(lines[i + 1].trim());
          }
        }
      }

      mainInfo.discrepancy = discrepancyLines.join(" ");

      // Add main info to table
      const mainTable = document.getElementById("mainInfoTable").querySelector("tbody");
      mainTable.innerHTML = `
        <tr>
          <td>${mainInfo.eventId}</td>
          <td>${mainInfo.equipId}</td>
          <td>${mainInfo.wuc}</td>
          <td>${mainInfo.symbol}</td>
          <td>${mainInfo.priority}</td>
          <td>${mainInfo.scheduled}</td>
          <td>${mainInfo.discrepancy}</td>
        </tr>
      `;

      // Process WCE events
      const wceTable = document.getElementById("wceTable").querySelector("tbody");
      wceTable.innerHTML = "";
      let currentNarrative = "";
      let currentWCE = null;

      for (let i = 0; i < lines.length; i++) {
        const line = lines[i];

        const wceMatch = line.match(/^\s*(\d{3})\s+(.{5})\s+(.{5})\s+(.{5}).{12}(@).{6}.{5}.{3}SCHED\s+(\d{7})$/);
        if (wceMatch) {
          currentWCE = {
            seq: wceMatch[1].trim(),
            pwc: wceMatch[2].trim(),
            equipId: wceMatch[3].trim(),
            wuc: wceMatch[4].trim(),
            symbol: wceMatch[5].trim(),
            scheduled: wceMatch[6].trim(),
            narrative: ""
          };
        }

        if (line.startsWith("NARR:")) {
          if (currentWCE) {
            currentWCE.narrative = line.replace("NARR:", "").trim();
            wceTable.innerHTML += `
              <tr>
                <td>${currentWCE.seq}</td>
                <td>${currentWCE.pwc}</td>
                <td>${currentWCE.equipId}</td>
                <td>${currentWCE.wuc}</td>
                <td>${currentWCE.symbol}</td>
                <td>${currentWCE.narrative}</td>
                <td>${currentWCE.scheduled}</td>
              </tr>
            `;
            currentWCE = null;
          }
        }
      }
    }
  </script>
</body>
</html>
